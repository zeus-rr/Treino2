<!doctype html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>SISTEMA ZEUS PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { 'pink-hot': '#FF1493' } } } }
    </script>
    <style>
        :root { --main-color: #FF1493; }
        .pink-bold { color: var(--main-color) !important; font-weight: 900; }
        .is-student-mode .admin-ui { display: none !important; }
        .serie-dot { width: 32px; height: 32px; border: 2px solid var(--main-color); border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; }
        .serie-dot.checked { background: var(--main-color); color: white; }
        #progressFill { height: 5px; background: var(--main-color); width: 0%; transition: 0.3s; position: fixed; top: 0; left: 0; z-index: 1000; }
    </style>
</head>
<body class="bg-[#0b0f1a] text-slate-100 font-sans min-h-screen">

    <div id="progressFill"></div>

    <header class="p-4 border-b border-slate-800 bg-slate-900/80 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-xl italic font-black pink-bold">SISTEMA ZEUS</h1>
            <div class="flex gap-4 items-center">
                <span id="studentDisplayHead" class="text-xs font-bold hidden sm:block"></span>
                <button onclick="document.documentElement.classList.toggle('dark')" class="p-2">üåì</button>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto p-4 grid grid-cols-1 lg:grid-cols-12 gap-6">
        <aside class="lg:col-span-4 space-y-4 admin-ui">
            <div class="bg-slate-900 p-6 rounded-3xl border border-slate-800">
                <input type="text" id="studentName" oninput="updateUI()" placeholder="Nome do Aluno" class="w-full bg-slate-800 p-3 rounded-xl mb-3 outline-none border-b-2 border-pink-hot">
                <select id="daySelector" class="w-full bg-slate-800 p-3 rounded-xl outline-none font-bold">
                    <option value="segunda">Segunda-feira</option>
                    <option value="terca">Ter√ßa-feira</option>
                    <option value="quarta">Quarta-feira</option>
                    <option value="quinta">Quinta-feira</option>
                    <option value="sexta">Sexta-feira</option>
                    <option value="sabado">S√°bado</option>
                </select>
            </div>

            <div class="bg-slate-900 p-6 rounded-3xl border border-slate-800">
                <h3 class="text-xs font-black pink-bold uppercase mb-4">Exerc√≠cios</h3>
                <div id="libMenu" class="space-y-2 max-h-64 overflow-y-auto pr-2 custom-scrollbar"></div>
            </div>
        </aside>

        <section class="lg:col-span-8 space-y-6">
            <div class="flex flex-wrap gap-2 admin-ui">
                <button onclick="exportToHTML()" class="bg-indigo-600 px-4 py-2 rounded-full text-[10px] font-bold">SALVAR HTML</button>
                <button onclick="document.getElementById('fileInput').click()" class="bg-amber-500 px-4 py-2 rounded-full text-[10px] font-bold">IMPORTAR</button>
                <button onclick="sendWhatsApp()" class="bg-green-600 px-4 py-2 rounded-full text-[10px] font-bold">ENVIAR WHATSAPP</button>
                <input type="file" id="fileInput" class="hidden" onchange="importFromHTML(event)">
            </div>

            <div id="weekDisplay" class="space-y-6"></div>

            <div class="bg-slate-900 p-6 rounded-3xl border border-slate-800">
                <h3 class="text-xs font-black pink-bold uppercase mb-2">Observa√ß√µes Gerais</h3>
                <textarea id="generalNotes" oninput="save()" class="w-full bg-slate-800 p-4 rounded-xl text-sm min-h-[100px] outline-none"></textarea>
            </div>
        </section>
    </main>

    <script>
        // Fun√ß√µes de Codifica√ß√£o Segura (UTF-8)
        const safeBtoA = (str) => btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (match, p1) => String.fromCharCode('0x' + p1)));
        const safeAtoB = (str) => decodeURIComponent(Array.prototype.map.call(atob(str), (c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));

        let workoutData = { 
            student: "", generalNotes: "", profPhone: "5500000000000",
            days: { segunda: [], terca: [], quarta: [], quinta: [], sexta: [], sabado: [] } 
        };

        function init() {
            const urlParams = new URLSearchParams(window.location.search);
            const alunoData = urlParams.get('aluno');

            if (alunoData) {
                try {
                    workoutData = JSON.parse(safeAtoB(alunoData));
                    document.body.classList.add('is-student-mode');
                } catch(e) { console.error("Erro ao carregar link."); loadLocal(); }
            } else { 
                loadLocal();
            }
            renderLib();
            render();
        }

        function loadLocal() {
            const s = localStorage.getItem('zeus_data');
            if(s) {
                try { workoutData = JSON.parse(s); } catch(e) { console.error("Cache corrompido."); }
            }
        }

        function save() {
            if(!document.body.classList.contains('is-student-mode')) {
                workoutData.student = document.getElementById('studentName').value;
                workoutData.generalNotes = document.getElementById('generalNotes').value;
                localStorage.setItem('zeus_data', JSON.stringify(workoutData));
            }
        }

        function render() {
            const container = document.getElementById('weekDisplay');
            container.innerHTML = "";
            const isStudent = document.body.classList.contains('is-student-mode');
            
            document.getElementById('studentDisplayHead').innerText = workoutData.student ? `ALUNO: ${workoutData.student.toUpperCase()}` : "";

            Object.keys(workoutData.days).forEach(day => {
                if (workoutData.days[day].length === 0) return;
                let html = `<div class="bg-slate-900 p-5 rounded-3xl border border-slate-800">
                    <h2 class="pink-bold uppercase italic mb-4">${day}</h2>`;
                
                workoutData.days[day].forEach((ex, i) => {
                    let seriesNum = parseInt(ex.r) || 0;
                    let dots = "";
                    if(isStudent) {
                        for(let j=1; j<=seriesNum; j++) dots += `<div class="serie-dot" onclick="this.classList.toggle('checked'); updateProgress();">${j}</div>`;
                    }

                    html += `<div class="mb-4 p-4 bg-slate-800/50 rounded-2xl relative">
                        <div class="flex justify-between">
                            <span class="font-bold text-sm uppercase">${ex.n}</span>
                            <button onclick="removeEx('${day}', ${i})" class="admin-ui text-red-500 font-bold">√ó</button>
                        </div>
                        <div class="text-[10px] mt-2 opacity-70">S√©ries: ${ex.r} | Carga: ${ex.w}</div>
                        <div class="flex gap-2 mt-3">${dots}</div>
                    </div>`;
                });
                container.innerHTML += html + `</div>`;
            });
        }

        function renderLib() {
            const lib = ["Supino Reto", "Puxada Frente", "Leg Press", "Agachamento", "Eleva√ß√£o Lateral", "Rosca Direta", "Tr√≠ceps Corda"];
            const container = document.getElementById('libMenu');
            lib.forEach(ex => {
                const div = document.createElement('div');
                div.className = "p-2 bg-slate-800 rounded-lg text-xs cursor-pointer hover:bg-pink-hot transition";
                div.innerText = ex;
                div.onclick = () => {
                    const day = document.getElementById('daySelector').value;
                    workoutData.days[day].push({ n: ex, r: "3x12", w: "---" });
                    save(); render();
                };
                container.appendChild(div);
            });
        }

        function removeEx(day, i) { workoutData.days[day].splice(i, 1); save(); render(); }
        
        function updateUI() { save(); render(); }

        function updateProgress() {
            const dots = document.querySelectorAll('.serie-dot');
            const checked = document.querySelectorAll('.serie-dot.checked');
            const pct = (checked.length / dots.length) * 100;
            document.getElementById('progressFill').style.width = pct + '%';
        }

        function exportToHTML() {
            const snapshot = safeBtoA(JSON.stringify(workoutData));
            const htmlContent = `<!DOCTYPE html>
            <html lang="pt-BR" class="dark">
            <head><meta charset="utf-8"><script src="https://cdn.tailwindcss.com"></script></head>
            <body class="bg-[#0b0f1a] text-white p-8">
                <h1 style="color:#FF1493">TREINO ZEUS: ${workoutData.student}</h1>
                <div class="mt-4">${document.getElementById('weekDisplay').innerHTML}</div>
                <script>function updateProgress(){}</script>
            </body></html>`;
            
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `TREINO_${workoutData.student || 'ALUNO'}.html`;
            a.click();
        }

        function importFromHTML(e) {
            const reader = new FileReader();
            reader.onload = (event) => {
                const match = event.target.result.match(/DATA_SNAPSHOT: (.*) -->/);
                if (match) {
                    workoutData = JSON.parse(safeAtoB(match[1]));
                    save(); render(); alert("Importado!");
                }
            };
            reader.readAsText(e.target.files[0]);
        }

        function sendWhatsApp() {
            const link = window.location.href.split('?')[0] + '?aluno=' + safeBtoA(JSON.stringify(workoutData));
            const msg = encodeURIComponent(`Ol√° ${workoutData.student}, seu treino est√° pronto: ${link}`);
            window.open(`https://api.whatsapp.com/send?text=${msg}`);
        }

        window.onload = init;
    </script>
</body>
</html>
